<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @ajlkn
-->
<html>
	<head>
		<title>Panel de Administración</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="main.css" />
	</head>
	<body class="is-preload">

		<!-- Header -->
			<section id="header">
				<header>
					<span class="image avatar"><img src="images/admin.jpg" alt="" /></span>
					<p>Admin del sistema</p>    
					<p>Gestión de empresas, trabajadores, viviendas e inquilinos</p>
				</header>

				<!-- Menú personalizado -->
				<nav id="nav">
					<ul>
						<li><a href="#empresas" onclick="mostrarSeccion('seccionEmpresas')" class="active">Empresas</a></li>
						<li><a href="#trabajadores" onclick="mostrarSeccion('seccionTrabajadores')">Trabajadores</a></li>
						<li><a href="#viviendas" onclick="mostrarSeccion('crearVivienda')">Viviendas</a></li>
						<li><a href="#inquilinos" onclick="mostrarSeccion('seccionInquilinos')">Inquilinos</a></li>
					</ul>
				</nav>
			</section>

		<!-- Contenido principal -->
			<section id="main">
				<div class="inner">

					<h1>Panel de Administración</h1>

					<!-- Sección Empresas -->
					<section id="seccionEmpresas" style="display: none;">
						<h2>Empresas</h2>
						<ul id="listaEmpresas"></ul>
						<form id="formEmpresa">
							<label for="nombre">Nombre:</label><br>
							<input type="text" id="nombre" name="nombre" required><br><br>
							<label for="cif">CIF:</label><br>
							<input type="text" id="cif" name="cif" required><br><br>
							<label for="sector">Sector:</label><br>
							<input type="text" id="sector" name="sector" required><br><br>
							<button type="submit">Crear Empresa</button>
						</form>
					</section>

					<!-- Sección Trabajadores -->
					<section id="seccionTrabajadores" style="display: none;">
						<h2>Trabajadores</h2>
						<ul id="listaTrabajadores"></ul>
						<form id="formTrabajador">
							<label for="nombreUsuario">Nombre de usuario:</label>
							<input type="text" id="nombreUsuario" name="nombre_usuario" required><br><br>
							<label for="passwordUsuario">Contraseña:</label>
							<input type="password" id="passwordUsuario" name="password" required><br><br>
							<label for="nombreTrabajador">Nombre:</label><br>
							<input type="text" id="nombreTrabajador" name="nombre" required><br><br>
							<label for="apellidosTrabajador">Apellidos:</label><br>
							<input type="text" id="apellidosTrabajador" name="apellidos" required><br><br>
							<label for="profesionTrabajador">Profesión:</label><br>
							<input type="text" id="profesionTrabajador" name="profesion"><br><br>
							<label for="empresaTrabajador">Empresa:</label><br>
							<select id="empresaTrabajador" name="id_empresa" required>
								<option value="">-- Selecciona una empresa --</option>
							</select><br><br>
							<button type="submit">Crear Trabajador</button>
						</form>
					</section>

					<!-- Sección Viviendas -->
					<section id="crearVivienda" style="display: none;">
						<h2>Viviendas</h2>
						<ul id="listaViviendas"></ul>
						<form id="formVivienda">
							<label for="direccion">Dirección:</label>
							<input type="text" name="direccion" id="direccion" required><br><br>
							<label for="escalera">Escalera:</label>
							<input type="text" name="escalera" id="escalera" required><br><br>
							<label for="piso">Piso:</label>
							<input type="number" name="piso" id="piso" required><br><br>
							<label for="letra">Letra:</label>
							<input type="text" name="letra" id="letra" required><br><br>
							<label for="habitaciones">Habitaciones:</label>
							<input type="number" name="habitaciones" id="habitaciones" required><br><br>
							<label for="metros_cuadrados">Metros Cuadrados:</label>
							<input type="number" name="metros_cuadrados" id="metros_cuadrados" required><br><br>
							<label for="observaciones">Observaciones:</label><br>
							<textarea name="observaciones" id="observaciones" rows="4" cols="50"></textarea><br><br>
							<button type="submit">Crear Vivienda</button>
						</form>
					</section>

					<!-- Sección Inquilinos -->
					<section id="seccionInquilinos" style="display: none;">
						<h2>Inquilinos</h2>
						<ul id="listaInquilinos"></ul>
						<form id="formInquilino">
							<label for="nombreUsuarioInquilino">Nombre de usuario:</label>
							<input type="text" id="nombreUsuarioInquilino" name="nombre_usuario" required><br><br>

							<label for="passwordUsuarioInquilino">Contraseña:</label><br>
							<input type="password" id="passwordUsuarioInquilino" name="password" required><br><br>

							<label for="nombreInquilino">Nombre:</label><br>
							<input type="text" id="nombreInquilino" name="nombre" required><br><br>

							<label for="apellidosInquilino">Apellidos:</label><br>
							<input type="text" id="apellidosInquilino" name="apellidos" required><br><br>

							<label for="fecha_nacimiento">Fecha de nacimiento:</label><br>
							<input type="date" id="fecha_nacimiento" name="fecha_nacimiento"><br><br>

							<label for="dni">DNI:</label><br>
							<input type="text" id="dni" name="dni" required><br><br>

							<label for="vivienda_id">Vivienda:</label><br>
							<select id="viviendaInquilino" name="vivienda_id" required>
								<option value="">-- Selecciona una vivienda --</option>
							</select><br><br>

							<button type="submit">Crear Inquilino</button>
						</form>
					</section>

				</div>
			</section>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			// Rellenar empresas en el formulario de trabajadores
			fetch('/api/empresas')
					.then(res => res.json())
					.then(data => {
						const select = document.getElementById('empresaTrabajador');
						data.forEach(empresa => {
							const option = document.createElement('option');
							option.value = empresa.id;
							option.textContent = empresa.nombre;
							select.appendChild(option);
						});
					})
					.catch(error => {
						console.error('Error al cargar empresas:', error);
					});
		});
		document.addEventListener("DOMContentLoaded", async () => {
			try {
				const res = await fetch("/api/viviendas"); // ya tienes esta ruta en routes.js
				const viviendas = await res.json();
				const select = document.getElementById("viviendaInquilino");

				viviendas.forEach(v => {
					const option = document.createElement("option");
					option.value = v.id;
					option.textContent = `${v.direccion || 'Vivienda'} #${v.id}`;
					select.appendChild(option);
				});
			} catch (error) {
				console.error("Error cargando viviendas:", error);
			}

			mostrarSeccion('seccionEmpresas'); // mantener la lógica existente
		});
    function mostrarSeccion(id) {
        document.querySelectorAll('#main section').forEach(seccion => {
            seccion.style.display = 'none';
        });
        const objetivo = document.getElementById(id);
        if (objetivo) objetivo.style.display = 'block';
        document.querySelectorAll('#nav ul li a').forEach(link => {
            link.classList.remove('active');
        });
        const enlaceActivo = document.querySelector(`#nav ul li a[onclick*="${id}"]`);
        if (enlaceActivo) enlaceActivo.classList.add('active');
    }
    document.addEventListener("DOMContentLoaded", function () {
        mostrarSeccion('seccionEmpresas');
    });
	// Formulario INQUILINO
	document.getElementById("formInquilino").addEventListener("submit", async function (e) {
		e.preventDefault();
		const formData = new FormData(e.target);
		const data = Object.fromEntries(formData.entries());

		const res = await fetch("/api/inquilinos", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(data)
		});

		const result = await res.json();
		if (res.ok) {
			alert("Inquilino creado correctamente");
			e.target.reset();
		} else {
			alert("Error: " + (result.error || "no se pudo crear"));
		}
	});

	// Formulario TRABAJADOR
	document.getElementById("formTrabajador").addEventListener("submit", async function (e) {
		e.preventDefault();
		const formData = new FormData(e.target);
		const data = Object.fromEntries(formData.entries());

		const res = await fetch("/api/trabajadores", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(data)
		});

		const result = await res.json();
		if (res.ok) {
			alert("Trabajador creado correctamente");
			e.target.reset();
		} else {
			alert("Error: " + (result.error || "no se pudo crear"));
		}
	});

	// Formulario EMPRESA
	document.getElementById("formEmpresa").addEventListener("submit", async function (e) {
		e.preventDefault();
		const formData = new FormData(e.target);
		const data = Object.fromEntries(formData.entries());

		const res = await fetch("/api/empresas", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(data)
		});

		const result = await res.json();
		if (res.ok) {
			alert("Empresa creada correctamente");
			e.target.reset();
		} else {
			alert("Error: " + (result.error || "no se pudo crear"));
		}
	});

	// Formulario VIVIENDA
	document.getElementById("formVivienda").addEventListener("submit", async function (e) {
		e.preventDefault();
		const formData = new FormData(e.target);
		const data = Object.fromEntries(formData.entries());

		const res = await fetch("/api/viviendas", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(data)
		});

		const result = await res.json();
		if (res.ok) {
			alert("Vivienda creada correctamente");
			e.target.reset();
		} else {
			alert("Error: " + (result.error || "no se pudo crear"));
		}
	});
</script>

	</body>
</html>
